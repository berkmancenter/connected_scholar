<script type="text/javascript">
    jQuery(document).ready(function() {

        $('#search_form').bind('ajax:before', function() {
            resetAdvancedSearch();
            $("#advanced_query").val($("#query").val());
            $("#advanced_search_dialog").dialog("open");
            $('#ajax_loading').show();
        });

        $('#advanced_search_form').bind('ajax:before', function() {
            $('#advanced_search_results').empty();
            $('#ajax_loading').show();
        });

        $('#search_form').bind('ajax:success', function(evt, data, status, xhr) {
            $('#ajax_loading').hide();
            $('#advanced_search_results').html(xhr.responseText);
        });

        $('#search_form').bind('ajax:error', function(evt, xhr, status, error) {
            $('#ajax_loading').hide();
        });

        $('#advanced_search_form').bind('ajax:success', function(evt, data, status, xhr) {
            $('#ajax_loading').hide();
            $('#advanced_search_results').html(xhr.responseText)
        });

        $('#advanced_search_form').bind('ajax:error', function(evt, xhr, status, error) {
            $('#ajax_loading').hide();
        });
    });
</script>

<%= form_tag('/search/keyword', :remote => true, :id => 'search_form', :method => :get, 'data-type' => 'html', :format => :html) do %>
    <%= text_field_tag :query, params[:query], :size => 15 %>
    <%= hidden_field_tag :search_type, 'keyword' %>
    <%= submit_tag "Go" %>
<% end %>
<a href="#" id="advanced_search_link">Advanced Search</a>
<br/>
<div id="advanced_search_dialog" style="display: none;">
  <%= form_tag('/search/advanced', :remote => true, :id => 'advanced_search_form', :method => :get, 'data-type' => 'html', :format => :html) do %>
      <%= label_tag "Query:" %>
      <div>
        <%= text_field_tag :query, params[:query], :id => 'advanced_query', :size => 50 %>
        <%= select_tag :search_type, "<option value='keyword'>Keyword</option>
                                    <option value='title_exact'>Exact Title</option>
                                    <option value='creator_exact'>Exact Creator</option>
                                    <option value='desc_subject_exact'>Exact Subject</option>
                                    <option value='title_keyword'>Title Keyword</option>
                                    <option value='creator_keyword'>Creator Keyword</option>
                                    <option value='desc_subject_keyword'>Subject Keyword</option>
                                    <option value='id_isbn'>Exact ISBN</option>
                                    <option value='id_lccn'>Exact LCCN</option>
                                    <option value='id_oclc'>Exact OCLN</option>".html_safe, :id => "advanced_search_type" %>
        <% for i in (1..3) %>
            <a href="#" id="add_filter<%= i %>">Add Filter</a>
            </div>
            <div id="filter<%= i %>_div" style="display:none;">
              <%= label_tag "Filter:" %>
              <br/>
              <%= text_field_tag "filter#{i}", params["filter#{i}"], :id => "advanced_filter#{i}", :size => 50 %>
              <%= select_tag "filter#{i}_type", "<option value='keyword'>Keyword</option>
                                            <option value='title_exact'>Exact Title</option>
                                            <option value='creator_exact'>Exact Creator</option>
                                            <option value='desc_subject_exact'>Exact Subject</option>
                                            <option value='title_keyword'>Title Keyword</option>
                                            <option value='creator_keyword'>Creator Keyword</option>
                                            <option value='desc_subject_keyword'>Subject Keyword</option>
                                            <option value='id_isbn'>Exact ISBN</option>
                                            <option value='id_lccn'>Exact LCCN</option>
                                            <option value='id_oclc'>Exact OCLN</option>".html_safe %>
        <% end %>
        </div>
        <br/>
        <%= submit_tag "Reset", :id => "advanced_search_reset", :type => "reset" %>
        <%= submit_tag "Search" %>
        <%= hidden_field_tag :limit, 25 %>
        <%= hidden_field_tag :start, 0  %>
    <% end %>
  <br/>

  <div id="ajax_loading" style="display: none;"><img src="/static/img/ajax-loader.gif" alt="Loading..."></div>
  <div id="advanced_search_results"></div>
</div>
<script>
    function recommend_resource(item_id) {
        $.post('/documents/<%= @document.id %>/resources', { "item_id":item_id}, function(data) {
            // TODO change "Recommend" link to a "Recommended" text
            // TODO refresh the RecommendedResources partial (if it exists on this page)
        });
        return false;
    }

    function resetAdvancedSearch() {
        $("#filter1_div").hide();
        $("#filter2_div").hide();
        $("#filter3_div").hide();
        $("#add_filter1").show();
        $("#add_filter2").show();
        $("#add_filter3").show();
        $("#advanced_filter1").val("");
        $("#advanced_filter2").val("");
        $("#advanced_filter3").val("");

        $("#advanced_search_type").val("keyword");
        $("#filter1_type").val("keyword");
        $("#filter2_type").val("keyword");
        $("#filter3_type").val("keyword");

        $('#advanced_search_results').empty();
    }

    $(function() {
        $("#advanced_search_link").click(function() {
            $("#advanced_search_dialog").dialog("open");
            return false;
        });

        <% for i in (1..3) %>
        $("#add_filter<%= i %>").click(function() {
            $("#add_filter<%= i %>").hide();
            $("#filter<%= i %>_div").show();
            return false;
        });
        <% end %>

        $("#advanced_search_reset").click(function() {
            resetAdvancedSearch();
        });

        $("#advanced_search_dialog").dialog({
            title: "Advanced Search",
            autoOpen: false,
            height: 500,
            width: 750,
            modal: true,
            buttons: {
                "Close": function() {
                    $(this).dialog("close");
                }
            }
        });
    });
</script>